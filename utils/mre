#!/usr/bin/perl

use strict;
use warnings;

my $list_mode = 0;

if ( defined $ARGV[0] and $ARGV[0] =~ m|^-{1,2}(\d+)$| ){
    # ahh they want us to list the "x" most recent, sweet
    $list_mode = $1;
    shift @ARGV;
}
my $dir = $ARGV[0] || ".";

my $latest;
my %files;
$latest->{tstamp}   = 0;
$latest->{filename} = "No files found in $dir";

opendir(my $dh , $dir) || die "Could not opendir $dir: $!";

# cd to $dir because readdir just gives filenames and without the chdir
# we would have to prepend $dir to $_ to do stuff to them  (-f and stat)
chdir($dir);

for ( readdir $dh ){
    lstat $_;
    next unless -f _;
    next if -l _;
    my $tstamp = (stat)[9] || 0;
    if ( $list_mode > 0 ){
        $files{$_} = $tstamp;
    }
    elsif ($tstamp > $latest->{tstamp}){
        $latest->{filename} = $_;
        $latest->{tstamp}   = $tstamp;
    }
}
closedir $dh;

if ( $list_mode > 0 ){
    my $cnt = 1;
    for ( reverse sort { $files{$a} <=> $files{$b} } keys %files ){
        print "$_\n";
        last if $cnt >= $list_mode;
        ++$cnt;
    }
}
else {
    print $latest->{filename}, "\n";
}
